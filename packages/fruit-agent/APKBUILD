# Maintainer: "Herry <herry.herry@glasgow.ac.uk>"
pkgname=fruit-agent
pkgver=0.0.1
pkgrel=0
pkgdesc="Fruit Agent"
url="https://fruit-testbed.org"
arch="noarch"
license="BSD"
depends="busybox openrc"
depends_dev=""
makedepends="$depends_dev"
install=""
subpackages=""
source="${pkgname}-master.zip::https://github.com/fruit-testbed/fruit-agent/archive/master.zip"
builddir="$srcdir/${pkgname}-master"
options="suid !check"

prepare() {
	default_prepare
}

build() {
	return 0
}

package() {
	mkdir -p ${pkgdir}/media/mmcblk0p1
	install -m640 -o root -g root ${builddir}/fruit.json ${pkgdir}/media/mmcblk0p1/fruit.json

	mkdir -p ${pkgdir}/usr/bin/
	install -m755 -o root -g root ${builddir}/JSON.sh ${pkgdir}/usr/bin/JSON.sh

	mkdir -p ${pkgdir}/usr/sbin/
	install -m750 -o root -g root ${builddir}/fruit-deploy.in ${pkgdir}/usr/sbin/fruit-deploy
	install -m750 -o root -g root ${builddir}/fruit-monitor.in ${pkgdir}/usr/sbin/fruit-monitor

	mkdir -p ${pkgdir}/etc/init.d/
	install -m755 -o root -g root ${builddir}/fruit.openrc ${pkgdir}/etc/init.d/fruit
	
	mkdir -p ${pkgdir}/etc/runlevels/boot
	cd ${pkgdir}/etc/runlevels/boot && ln -sf /etc/init.d/fruit fruit

	return 0
}	
sha512sums="800960492bffde555633245c224e683a3a20494c8b6a98527e38a1cb4ed3c620a9ca96ccbd2e5b134e51fedc4b58440549f299f886149013ac2c978b1190434a  fruit-agent-master.zip"
